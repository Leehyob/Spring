<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.trip.mapper.PlanMapper">
	
	<insert id="insertContentIntoPlan">
		insert into travelContent(plan_id, content_id, day,time)
		values(#{plan_id},#{content_id},#{day},02:00:00)
	</insert>
	
	<resultMap type="kr.trip.domain.ContentVO" id="ContentVO">
	    <result column="content_id" property="content_id"/>
	    <result column="addr1" property="addr1"/>
	    <result column="addr2" property="addr2"/>
	    <result column="phone" property="phone"/>
	    <result column="cExplain" property="cExplain"/>
	    <result column="areaname" property="areaname"/>
	    <result column="contentType" property="contentType"/>
	    <result column="created_time" property="created_time"/>
	    <result column="likeNum" property="likeNum"/>
	    <result column="image1" property="image"/>
	</resultMap>
	
	<resultMap type="kr.trip.domain.TravelContentVO" id="TravelContentVO">
	    <result column="plan_id" property="plan_id"/>
	    <result column="content_id" property="content_id"/>
	    <result column="day" property="day"/>
	    <result column="time" property="time"/>
	    <collection property="contentList" resultMap="ContentVO"/>
	</resultMap>
	
	<resultMap type="kr.trip.domain.TravelPlanVO" id="TravelPlanVO">
	    <result column="plan_id" property="plan_id"/>
	    <result column="regdate" property="regdate"/>
	    <result column="go" property="go"/>
	    <result column="end" property="end"/>
	    <result column="day" property="day"/>
	    <result column="tpa_id" property="tpa_id"/>
	    <collection property="travelContentList" resultMap="TravelContentVO"/>
	</resultMap>

<select id="getContentListOfPlan" parameterType="int" resultMap="ContentVO">
    SELECT tp.plan_id, tp.regdate, tp.go, tp.end, tp.day, tp.tpa_id,
           tc.content_id, tc.day AS tc_day, tc.time AS tc_time,
           c.ContentType, c.addr2, c.image1
    FROM travelPlan tp
    LEFT JOIN TravelContent tc ON tp.plan_id = tc.plan_id
    LEFT JOIN content c ON tc.content_id = c.content_id
    WHERE tp.plan_id = #{plan_id}
</select>

	
</mapper>